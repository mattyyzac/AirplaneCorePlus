function renermap(n){let t=Math.floor(Math.random()*6);redraw(n,t===undefined||isNaN(t)?0:t)}function redraw(n,t){mapboxgl.accessToken=document.querySelector("#mapboxtoken").value;let i=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/"+styles[t]+"-v9",center:[n.coords.longitude,n.coords.latitude],zoom:7}),r=new mapboxgl.NavigationControl;i.addControl(r,"bottom-right");i.on("load",()=>{mapcallback(i)})}function mapcallback(n){n.addSource("airports",{type:"geojson",data:"/api/airports/get"});n.addLayer({id:"airport",type:"circle",source:"airports",filter:["!has","point_count"],paint:{"circle-color":"navy","circle-radius":6,"circle-stroke-width":1,"circle-stroke-color":"#fff"}});n.on("mouseenter","airport",t=>{n.getCanvas().style.cursor="pointer";let r=t.features[0].geometry.coordinates.slice(),u=t.features[0].properties.name,i=t.features[0].properties.iataCode,f=i&&i.length>0?` | ${i}`:"";document.querySelector("#airport-name").innerText=`${u}${f}`;document.querySelector("#info-card").style.display="";let e=r[0],o=r[1];fetch(`/api/g/r/${e}/${o}/${u}/400/${lang}`).then(n=>n.json()).then(n=>{document.querySelector("#airport-image").src=n.photo?"data:image/png;base64,"+n.photo:"https://via.placeholder.com/400x200?text=No+Image+Found",document.querySelector("#airport-name").innerText=`${n.name}${f}`,document.querySelector("#airport-address").innerText=n.formattedAddress||"",document.querySelector("#airport-phone").innerText=n.phoneNumber||"",document.querySelector("#airport-website").innerText=n.website||"",document.querySelector("#more-info").style.display=""}).catch(n=>{console.log(n),document.querySelector("#airport-image").src="https://via.placeholder.com/400x200?text=Error+while+loading+data"})});n.on("mouseleave","airport",()=>{n.getCanvas().style.cursor="",document.querySelector("#info-card").style.display="none",document.querySelector("#airport-image").src="https://via.placeholder.com/400x200?text=loading",document.querySelector("#airport-name").innerText="",document.querySelector("#airport-address").innerText="",document.querySelector("#airport-phone").innerText="",document.querySelector("#airport-website").innerText=""});var t=places({container:document.querySelector("#place-input"),type:"city"});t.on("change",t=>{n.flyTo({center:[t.suggestion.latlng.lng,t.suggestion.latlng.lat],zoom:9})})}let lang="";const styles=["basic","streets","bright","light","dark","satellite"];(function(){if(navigator.languages){var n=navigator.languages;lang=n[0]}navigator.geolocation&&navigator.geolocation.getCurrentPosition(renermap)})();document.querySelector("#info-card-close-button").addEventListener("click",function(){document.querySelector("#info-card").style.display="none";document.querySelector("#airport-image").src="https://via.placeholder.com/400x200?text=loading";document.querySelector("#airport-name").innerText="";document.querySelector("#airport-address").innerText="";document.querySelector("#airport-phone").innerText="";document.querySelector("#airport-website").innerText=""});